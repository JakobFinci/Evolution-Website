<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linear Deep-Time Visualizer</title>
<style>
  :root{ --bg:#0b0f14; --ink:#e7edf4; --muted:#9fb3c8; --accent:#6ee7ff; }
  html,body{height:100%; margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; color:var(--ink); background:linear-gradient(180deg,#0b0f14,#0d1218);}    
  header{padding:16px 20px; border-bottom:1px solid #1f2a36; display:flex; align-items:center; gap:16px;}
  h1{font-size:20px; margin:0; font-weight:700; letter-spacing:.2px}
  .wrap{display:grid; grid-template-columns:280px 1fr; gap:18px; padding:16px 18px;}
  .panel{background:#0e141b; border:1px solid #1f2a36; border-radius:14px; padding:14px; color:var(--ink);}
  label{display:block; font-size:13px; color:var(--muted); margin:10px 0 6px}
  input[type="range"]{width:100%}
  .tiny{font-size:12px; color:var(--muted)}
  #stageWrap{overflow:auto; border-radius:14px; border:1px solid #1f2a36;}
  #stage{display:block; background:#0b0f14}
  .srcs{font-size:12px; line-height:1.35; margin-top:16px; color:var(--muted)}

.legend-box {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 12px 0;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--muted);
}
.legend-swatch {
  width: 14px;
  height: 14px;
  border-radius: 3px;
}

</style>
</head>
<body>
  <header>
    <h1>Linear Time Visualizer</h1>
  </header>

  <div class="wrap">
    <aside class="panel">
      <h2 style="font-size:14px; color:var(--muted);">Controls</h2>
      <label>Pixels per million years (<span id="ppmOut">1.00</span> px/MYA)</label>
      <input id="ppm" type="range" min="0.2" max="2.5" step="0.05" value="1" />
      <label>Zoom center (GYA): <span id="zoomOut">2.30</span></label>
      <input id="zoom" type="range" min="-1.95" max="2.45" step="0.05" value="2.3" />
      <label><input id="showTicks" type="checkbox" checked /> Show ticks</label>

      <h2 style="font-size:14px; color:var(--muted); margin-top:14px;">Color legend</h2>

      <div class="legend-box">
      <div class="legend-item"><div class="legend-swatch" style="background:#89c2ff"></div> Biology</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#ffd089"></div> Environment</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#ff8d8d"></div> Extinction</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#ffffff"></div> Humans</div>
      </div>

      <h2 style="font-size:14px; color:var(--muted); margin-top:14px;">Included events</h2>
      <div id="evList" class="tiny"></div>
    </aside>


    <section class="panel" id="stageWrap">
      <svg id="stage" xmlns="http://www.w3.org/2000/svg" width="4600" height="400" viewBox="0 0 4600 400"></svg>
      <div class="srcs">
        <strong>Scientific Sources (APA):</strong><br>
        Dalrymple, G. B. (2001). <em>The age of the Earth in the twentieth century</em>. Geological Society, London, Special Publications, 190(1), 205–221.<br>
        Mojzsis, S. J., et al. (1996). Evidence for life on Earth before 3,800 million years ago. <em>Nature, 384</em>, 55–59.<br>
        Lyons, T. W., Reinhard, C. T., & Planavsky, N. J. (2014). The rise of oxygen in Earth’s early ocean and atmosphere. <em>Nature, 506</em>, 307–315.<br>
        Wellman, C. H., et al. (2003). Fragments of the earliest land plants. <em>Nature, 425</em>, 282–285.<br>
        Schulte, P., et al. (2010). The Chicxulub asteroid impact and mass extinction at the Cretaceous–Paleogene boundary. <em>Science, 327</em>, 1214–1218.<br>
        Stringer, C. (2016). The origin and evolution of <em>Homo sapiens</em>. <em>Nature, 539</em>, 49–51.
      </div>
    </section>
  </div>

<script>
(function(){
  const Tmax = 4600; // Myr (4.6 Ga)
  const CAT = { Biology:'#89c2ff', Environment:'#ffd089', Extinction:'#ff8d8d', Humans:'#ffffff' };
  const events = [
    {t:4540, label:'Formation of Earth', cat:'Environment'},
    {t:3800, label:'Earliest life', cat:'Biology'},
    {t:2500, label:'Origin of eukaryotes', cat:'Biology'},
    {t:2400, label:'Great Oxygenation Event', cat:'Extinction'},
    {t:2100, label:'Earliest multicellularity', cat:'Biology'},
    {t:525,  label:'Origin of vertebrates', cat:'Biology'},
    {t:470,  label:'Land plants', cat:'Biology'},
    {t:230,  label:'Earliest dinosaurs', cat:'Biology'},
    {t:200,  label:'Origin of mammals', cat:'Biology'},
    {t:66,   label:'K–Pg mass extinction', cat:'Extinction'},
    {t:0.2,  label:'Homo sapiens', cat:'Humans'},
    {t:0,    label:'Present', cat:'Humans'}
  ];

  const svg = document.getElementById('stage');
  const ppm = document.getElementById('ppm');
  const zoomCtl = document.getElementById('zoom');
  const zoomOut = document.getElementById('zoomOut');
  const ppmOut = document.getElementById('ppmOut');
  const showTicks = document.getElementById('showTicks');
  const evList = document.getElementById('evList');

  function xFromMyr(myr, pxPerMyr){
    return (Tmax - myr) * pxPerMyr;
  }

  function fmtAge(myr){
    if(myr >= 1000) return (myr/1000).toFixed(2).replace(/\.00$/,'') + ' GYA';
    if(myr >= 1) return Math.round(myr) + ' MYA';
    return Math.round(myr*1000) + ' KYA';
  }

  function render(){
    const pxPerMyr = parseFloat(ppm.value);
    const zoomGa = parseFloat(zoomCtl.value);
    zoomOut.textContent = zoomGa.toFixed(2);
    ppmOut.textContent = pxPerMyr.toFixed(2);

    const W = Math.round(Tmax * pxPerMyr);
    const H = 400;
    svg.setAttribute('width', W);
    svg.setAttribute('height', H);

    const zoomMyr = zoomGa * 1000;
    const zoomCenterX = xFromMyr(zoomMyr, pxPerMyr);
    const viewWidth = 800;

    let viewX = zoomCenterX - viewWidth / 2;
    svg.setAttribute('viewBox', `${viewX} 0 ${viewWidth} ${H}`);

    while(svg.firstChild) svg.removeChild(svg.firstChild);
    const margin = {l:40, r:40, t:30, b:90};
    const axisY = H - margin.b;

    const axis = document.createElementNS('http://www.w3.org/2000/svg','line');
    axis.setAttribute('x1', 0);
    axis.setAttribute('x2', W);
    axis.setAttribute('y1', axisY);
    axis.setAttribute('y2', axisY);
    axis.setAttribute('stroke', '#a6b3c3');
    svg.appendChild(axis);

    if(showTicks.checked){
      for(let myr=0; myr<=Tmax; myr+=100){
        const x = xFromMyr(myr, pxPerMyr);
        const big = (myr % 500 === 0);
        const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
        tick.setAttribute('x1', x);
        tick.setAttribute('x2', x);
        tick.setAttribute('y1', axisY);
        tick.setAttribute('y2', axisY + (big?12:6));
        tick.setAttribute('stroke', '#a6b3c3');
        svg.appendChild(tick);
      }
    }

    let flip=true;
    let lastX = -Infinity;
    events.forEach(ev=>{
      const x=xFromMyr(ev.t,pxPerMyr);
      const stem=document.createElementNS('http://www.w3.org/2000/svg','line');
      stem.setAttribute('x1',x);stem.setAttribute('x2',x);
      stem.setAttribute('y1',margin.t+10);stem.setAttribute('y2',axisY);
      stem.setAttribute('stroke',CAT[ev.cat]);
      stem.setAttribute('stroke-width','2');
      svg.appendChild(stem);

      const text=document.createElementNS('http://www.w3.org/2000/svg','text');
      let offsetY = margin.t + (flip ? 0 : 30);
      if (Math.abs(x - lastX) < 50) offsetY += flip ? -20 : 20; // stagger close labels
      text.setAttribute('x',x);
      text.setAttribute('y',offsetY);
      text.setAttribute('text-anchor','middle');
      text.setAttribute('font-size','12');
      text.setAttribute('fill','#e7edf4');
      text.textContent=`${ev.label} (${fmtAge(ev.t)})`;
      svg.appendChild(text);

      lastX = x;
      flip=!flip;
    });
  }

  evList.innerHTML = events.map(e => `• ${e.label} — ${fmtAge(e.t)}`).join('<br>');

  ppm.addEventListener('input', render);
  zoomCtl.addEventListener('input', render);
  showTicks.addEventListener('input', render);
  showTicks.addEventListener('change', render);

  render();
})();

</script>
  <audio id="bgMusic" autoplay loop muted>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const music = document.getElementById('bgMusic');
  if (!music) return;
  music.volume = 0.25;
  
  // Step 1: Start muted (bypasses autoplay restrictions)
  const playPromise = music.play();
  
  if (playPromise !== undefined) {
    playPromise
      .then(() => {
        // Step 2: After a short delay, unmute gently
        setTimeout(() => {
          music.muted = false;
        }, 800); // gives the browser a moment to accept playback
      })
      .catch(() => {
        // Fallback: play after first user click (no visual text)
        const enable = () => {
          music.play();
          music.muted = false;
          document.removeEventListener('click', enable);
        };
        document.addEventListener('click', enable, { once: true });
      });
  }
});
</script>

</body>
</html>
